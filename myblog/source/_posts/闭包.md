### 闭包

> 从性能角度讲，项目中应该减少对闭包的使用（因为闭包会产生不释放的栈内存，过多使用容易导致内存溢出或者降低性能）

> 作用：
>
> 1. 保护（私有变量和外界没有必然联系）
> 2. 保存（形成不销毁的栈内存，里面的私有变量等信息保存下来了）

1、JQuery -> 为了防止全局变量污染，JQ中的方法和变量需要用闭包保护起来。（导入jq后，它里面有大量的方法，如果不把这些方法保护起来，用户编写的方法很容易和jq方法名相同产生冲突，即全局变量污染）

```javascript
/*  *****  JQuery源码  ***** */
(function(global,factory){
    //area1
    ...  
    //typeof window !== 'undefined'?window:this   ->   验证当前所处环境的全局对象是window还是global等
    //factory -> function(window,noGlobal){}
    factory(global);  // -> 执行area2-function
})(typeof window !== 'undefined'?window:this,function(window,noGlobal){
    //area2
    ...
    var jQuery = function(){
        ...
    }
    
    //通过给全局对象增加属性，把私有jquery方法暴露到全局作用域下供外面使用(<=>等价于return  jQuery)
    //外面需要使用函数中的私有内容，可以基于window.xxx和return xxx两种方式实现。
    window.jQuery = window.$ = jQuery; 
});
    
/*  *****  使用  ***** */
jQuery();  //相当于window.jQuery()
或
$();
```

真实项目中，我们一般把自己写的内容放到一个闭包中，这样可以有效防止自己的代码和别人代码产生冲突（全局变量污染：真实项目中是尽可能减少对全局变量的使用的）；如果需要把自己的东西给别人用，基于return和window.xxx等方式暴露给别人即可。



2、基于let/const/class等创建变量，会把所在大括号（除对象的大括号之外）当作一个全新的私有块级作用域；

- 函数执行会产生私有的栈内存（作用域/执行上下文）
- let等也会产生私有的栈内存（var不会）